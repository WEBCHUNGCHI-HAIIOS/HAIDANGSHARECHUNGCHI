<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flappy Bird</title>
<style>
body{
    margin:0;
    background:#87CEEB;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
canvas{
    background:#70c5ce;
}
</style>
</head>
<body>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ===== THÊM ẢNH CON CHIM =====
let birdImg = new Image();
birdImg.src = "https://i.imgur.com/QZ6XK8F.png"; // ảnh chim

// ===== THÔNG SỐ CŨ GIỮ NGUYÊN =====
let gravity = 0.3;
let lift = -6;

let bird = {
    x: 80,
    y: 300,
    size: 40,
    velocity: 0
};

let pipes = [];
let score = 0;
let gameOver = false;

function createPipe(){
    let gap = 160;
    let topHeight = Math.random()*300 + 50;
    pipes.push({
        x:400,
        top: topHeight,
        bottom: topHeight + gap,
        width:60
    });
}

function resetGame(){
    bird.y = 300;
    bird.velocity = 0;
    pipes = [];
    score = 0;
    gameOver = false;
}

function jump(){
    if(!gameOver){
        bird.velocity = lift;
    }else{
        resetGame();
    }
}

document.addEventListener("keydown", e=>{
    if(e.code==="Space") jump();
});
canvas.addEventListener("click", jump);

function update(){
    if(gameOver) return;

    bird.velocity += gravity;
    bird.y += bird.velocity;

    if(bird.y + bird.size > canvas.height || bird.y < 0){
        gameOver = true;
    }

    pipes.forEach(pipe=>{
        pipe.x -= 2;

        if(
            bird.x + bird.size > pipe.x &&
            bird.x < pipe.x + pipe.width &&
            (bird.y < pipe.top || bird.y + bird.size > pipe.bottom)
        ){
            gameOver = true;
        }

        if(pipe.x + pipe.width < 0){
            score++;
        }
    });

    pipes = pipes.filter(p=>p.x + p.width > 0);

    if(Math.random()<0.02){
        createPipe();
    }
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ===== VẼ CHIM BẰNG ẢNH =====
    ctx.drawImage(birdImg, bird.x, bird.y, bird.size, bird.size);

    // Vẽ ống
    ctx.fillStyle="green";
    pipes.forEach(pipe=>{
        ctx.fillRect(pipe.x,0,pipe.width,pipe.top);
        ctx.fillRect(pipe.x,pipe.bottom,pipe.width,canvas.height);
    });

    ctx.fillStyle="white";
    ctx.font="30px Arial";
    ctx.fillText(score, canvas.width/2,50);

    if(gameOver){
        ctx.fillStyle="red";
        ctx.font="40px Arial";
        ctx.fillText("GAME OVER",90,300);
        ctx.font="20px Arial";
        ctx.fillText("Click để chơi lại",120,340);
    }
}

function gameLoop(){
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

birdImg.onload = ()=>{
    gameLoop();
};
</script>

</body>
</html>
